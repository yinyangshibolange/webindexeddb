!function(){"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function r(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class n{constructor(e){r(this,"dbInfo",{name:"dbname",db:null,version:1,stores:[]}),this.dbInfo=e,this.init()}init(){return new Promise(((e,r)=>{const n=window.indexedDB.open(this.dbInfo.name,this.dbInfo.version);n.onsuccess=t=>{this.dbInfo.db=t.target.result,e(this.dbInfo.db)},n.onerror=e=>{r(e)},n.onupgradeneeded=e=>{let r;this.dbInfo.db=e.target.result,Array.isArray(this.dbInfo.stores)&&this.dbInfo.stores.forEach((e=>{const{storeName:n,indexs:o,mainKey:s}=e;this.dbInfo.db.objectStoreNames.contains(n)||(r=this.dbInfo.db.createObjectStore(n,{keyPath:s||"id"})),Array.isArray(o)&&o.forEach((e=>{try{r.createIndex(e.name,e.keyPath,t({unique:!1},e.params))}catch(e){console.error(e)}}))}))}}))}openDB(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbInfo.name,this.dbInfo.version);r.onsuccess=t=>{this.dbInfo.db=t.target.result,e(this.dbInfo.db)},r.onerror=e=>{t(e)}}))}addData(e,t){return new Promise(((r,n)=>{let o=this.dbInfo.db.transaction([e],"readwrite").objectStore(e).add(t);o.onsuccess=e=>{r(e)},o.onerror=e=>{throw new Error(e.target.error)}}))}getDataByKey(e,t){return new Promise(((r,n)=>{let o=this.dbInfo.db.transaction([e]).objectStore(e).get(t);o.onerror=e=>{n(e)},o.onsuccess=e=>{r(o.result)}}))}cursorGetData(e){let t=[],r=this.dbInfo.db.transaction(e,"readwrite").objectStore(e).openCursor();return new Promise(((e,n)=>{r.onsuccess=r=>{let n=r.target.result;n?(t.push(n.value),n.continue()):e(t)},r.onerror=e=>{n(e)}}))}cursorPage(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise(((t,o)=>{let s=[],i=this.dbInfo.db.transaction([e],"readonly").objectStore(e),c=i.openCursor(),a=i.count(),u=null;c.onsuccess=e=>{let o=e.target.result;if(o){if(u===n-1){s.push(o.value);try{t({list:s,total:a.result})}catch(e){t({list:[],total:0})}return}null===u&&1!==r?(u=0,o.advance((r-1)*n)):(u++,s.push(o.value),o.continue())}else try{t({list:s,total:a.result})}catch(e){t({list:[],total:0})}},c.onerror=()=>{o("读取数据失败")}}))}getDataByIndex(e,t,r){let n=this.dbInfo.db.transaction(e,"readwrite").objectStore(e).index(t).get(r);return new Promise(((e,t)=>{n.onerror=e=>{t(e)},n.onsuccess=t=>{e(t.target.result)}}))}cursorGetDataByIndex(e,t){let r=[],n=this.dbInfo.db.transaction(e,"readwrite").objectStore(e);return new Promise(((o,s)=>{const{indexs:i}=this.dbInfo.stores.find((t=>t.storeName===e))||{};if(!i)return void o([]);let c="",a=[];for(const e in t)c+=","+e,a.push(t[e]);c=c.substring(1);const{name:u}=i.find((e=>e.keyPath===c))||{};if(!u)return void o([]);let d=n.index(u).openCursor(IDBKeyRange.only(1===a.length?a[0]:a));d.onsuccess=e=>{let t=e.target.result;t?(r.push(t.value),t.continue()):o(r)},d.onerror=e=>{s(e)}}))}updateDB(e,t){let r=this.dbInfo.db.transaction([e],"readwrite").objectStore(e).put(t);return new Promise(((e,t)=>{r.onsuccess=t=>{e(t)},r.onerror=t=>{e(t)}}))}deleteDB(e,t){let r=this.dbInfo.db.transaction([e],"readwrite").objectStore(e).delete(t);return new Promise(((e,t)=>{r.onsuccess=t=>{e(t)},r.onerror=t=>{e(t)}}))}deleteDBAll(e){let t=window.indexedDB.deleteDatabase(e);return new Promise(((e,r)=>{t.onerror=e=>{console.error(e)},t.onsuccess=e=>{console.info(e)}}))}closeDB(){this.dbInfo.db.close(),console.info("数据库已关闭")}}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function s(e){const t=[{key:"addtime",type:"desc"},...(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[])||[]];let r=e;return t.forEach((e=>{let t,n;"string"==typeof e?(t="desc",n=e):"object"==typeof e&&(t="string"==typeof e.type?e.type.toLowerCase():"desc",n=e.key),"desc"===t?r=r.sort(((e,t)=>t[n]-e[n])):"asc"===t&&(r=r.sort(((e,t)=>e[n]-t[n])))})),r}function i(e,t){const r=e.find((e=>e.storeName===t));if(r)return r.mainKey||"id"}Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e}}();
